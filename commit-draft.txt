refactored from chuboe to stack_wf
